# ุฏููู ุฅููุงู MVP - SmartCare Clinics

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ุงูููุฒุงุช ุงููุงูุตุฉ ูุฅููุงู ุงูู MVP ุญุณุจ ูุชุทูุจุงุช PRD.MD. ูุฐุง ุงูุฏููู ููุถุญ ุงูุชุญุฏูุซุงุช ูุงูุฎุทูุงุช ุงููุทููุจุฉ ููุชูุนูู.

## โ ุงูููุฒุงุช ุงููุถุงูุฉ

### 1. ูุธุงู ุงููุชุงุจุนุฉ ุงูุขูู (Follow-up System)

#### ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ:
- **follow_up_tasks**: ุฌุฏูู ููุงู ุงููุชุงุจุนุฉ
  - ุชุชุจุน ุงููุชุงุจุนุงุช ุงููุทููุจุฉ ููู ูุฑูุถ
  - ุชุงุฑูุฎ ุงูุงุณุชุญูุงู ูุญุงูุฉ ุงูุฅูุฌุงุฒ
  - ุฑุจุท ุจุงูุงุณุชุดุงุฑุฉ ูุงูุทุจูุจ ูุงููุฑูุถ

#### Cron Jobs:
- **Daily at 8:00 AM**: ูุญุต ุงููุชุงุจุนุงุช ุงููุณุชุญูุฉ ุงูููู
- **Daily at 6:00 PM**: ุชูุจูู ุจุงููุชุงุจุนุงุช ุงููุชุฃุฎุฑุฉ
- **Every Hour**: ุชุฐููุฑ ุจุงูููุงุนูุฏ ุงููุงุฏูุฉ (ุฎูุงู ุณุงุนุชูู)

#### API Endpoints:
```
GET    /api/follow-up-tasks              # ูุงุฆูุฉ ุงููุชุงุจุนุงุช
GET    /api/follow-up-tasks/due          # ุงููุชุงุจุนุงุช ุงููุณุชุญูุฉ
GET    /api/follow-up-tasks/overdue      # ุงููุชุงุจุนุงุช ุงููุชุฃุฎุฑุฉ
POST   /api/follow-up-tasks              # ุฅูุดุงุก ูุชุงุจุนุฉ ุฌุฏูุฏุฉ
POST   /api/follow-up-tasks/:id/complete # ุฅููุงู ูุชุงุจุนุฉ
PATCH  /api/follow-up-tasks/:id          # ุชุญุฏูุซ ูุชุงุจุนุฉ
DELETE /api/follow-up-tasks/:id          # ุญุฐู ูุชุงุจุนุฉ
```

### 2. ูุธุงู ุณุฌู ุงูุงุชุตุงูุงุช (Communication Logs)

#### ุงูุฌุฏูู ุงูุฌุฏูุฏ:
- **communication_logs**: ุณุฌู ุฌููุน ุงูุงุชุตุงูุงุช ูุน ุงููุฑุถู
  - ุฃููุงุน: ููุงููุฉุ ูุงุชุณุงุจุ SMSุ ุจุฑูุฏ ุฅููุชุฑูููุ ุดุฎุตู
  - ุญุงูุงุช: ูุงุฌุญุ ูุดูุ ูู ูุฑุฏุ ูุฌุฏูู
  - ููุงุญุธุงุช ูุชูุงุตูู ูู ุงุชุตุงู

#### API Endpoints:
```
GET    /api/patients/:patientId/communications  # ุณุฌู ุงุชุตุงูุงุช ุงููุฑูุถ
POST   /api/communication-logs                  # ุชุณุฌูู ุงุชุตุงู ุฌุฏูุฏ
PATCH  /api/communication-logs/:id              # ุชุญุฏูุซ ุณุฌู ุงุชุตุงู
DELETE /api/communication-logs/:id              # ุญุฐู ุณุฌู ุงุชุตุงู
```

### 3. ูุธุงู ุฅุฏุงุฑุฉ ุงููููุงุช (Patient Files)

#### ุงูุฌุฏูู ุงูุฌุฏูุฏ:
- **patient_files**: ูููุงุช ููุฑููุงุช ุงููุฑุถู
  - ุฃููุงุน: ูุชุงุฆุฌ ูุฎุชุจุฑุ ุฃุดุนุฉุ ูุตูุงุชุ ุชูุงุฑูุฑุ ุฃุฎุฑู
  - ูุนูููุงุช ุงูููู: ุงูุงุณูุ ุงูุญุฌูุ ุงูุฑุงุจุทุ ุงููุตู
  - ุฑุจุท ุจุงููุฑูุถ ูุงูุงุณุชุดุงุฑุฉ ูุงููุณุชุฎุฏู ุงูุฐู ุฑูุน ุงูููู

#### API Endpoints:
```
GET    /api/patients/:patientId/files  # ูููุงุช ุงููุฑูุถ
GET    /api/patient-files/:id          # ููู ูุญุฏุฏ
POST   /api/patient-files              # ุฑูุน ููู ุฌุฏูุฏ
DELETE /api/patient-files/:id          # ุญุฐู ููู
```

### 4. ุชุญุณููุงุช ุงูุณุฌู ุงูุทุจู

#### ุญููู ุฌุฏูุฏุฉ ูู ุฌุฏูู patients:
- **chronic_diseases**: ุงูุฃูุฑุงุถ ุงููุฒููุฉ (JSONB)
- **allergies**: ุงูุญุณุงุณูุฉ (JSONB)
- **current_medications**: ุงูุฃุฏููุฉ ุงูุญุงููุฉ (JSONB)
- **medical_notes**: ููุงุญุธุงุช ุทุจูุฉ

### 5. ููู ุงููุฑูุถ ุงูุดุงูู

#### API Endpoint ุฌุฏูุฏ:
```
GET /api/patients/:id/full-profile
```

ูุนูุฏ:
- ูุนูููุงุช ุงููุฑูุถ ุงูุฃุณุงุณูุฉ
- ุขุฎุฑ 10 ุงุณุชุดุงุฑุงุช
- ุงูููุงุนูุฏ ุงููุงุฏูุฉ
- ุงููุชุงุจุนุงุช ุงููุนููุฉ
- ุขุฎุฑ 5 ูููุงุช
- ุขุฎุฑ 10 ุงุชุตุงูุงุช

### 6. ุฅุญุตุงุฆูุงุช Dashboard ูุญุณููุฉ

#### API Endpoint:
```
GET /api/dashboard/stats?doctor_id=xxx&clinic_id=xxx
```

ูุนูุฏ:
- ุนุฏุฏ ููุงุนูุฏ ุงูููู
- ุนุฏุฏ ุงููุชุงุจุนุงุช ุงููุนููุฉ
- ุนุฏุฏ ุงูุฅุญุงูุงุช ุงููุนููุฉ
- ุฅุฌูุงูู ุงููุฑุถู

## ๐๏ธ ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฎุทูุฉ 1: ุชุทุจูู Migration

ุงุณุชุฎุฏู Supabase MCP ูุชุทุจูู ุงูุชุญุฏูุซุงุช:

```sql
-- ุฑุงุฌุน ููู: shared/schema-updates.sql
```

ุฃู ุงุณุชุฎุฏู Drizzle Kit:

```bash
npm run db:push
```

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฌุฏุงูู

```sql
-- ุงูุชุญูู ูู ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('follow_up_tasks', 'communication_logs', 'patient_files');
```

## ๐ ุงูุชูุนูู

### 1. ุชุญุฏูุซ server/storage.ts

ุฃุถู ุงูุฏูุงู ูู `server/storage-mvp-additions.ts` ุฅูู `server/storage.ts`:

```typescript
// ูู ููุงูุฉ server/storage.ts
export * from './storage-mvp-additions';
```

### 2. ุงูุชุญูู ูู Cron Jobs

ุงูู Cron Jobs ุชุจุฏุฃ ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู ุงูุณูุฑูุฑ. ุชุญูู ูู ุงูููุฌ:

```
[CRON] Starting follow-up scheduler...
[CRON] Follow-up scheduler started successfully
[CRON] - Daily follow-up check: 8:00 AM
[CRON] - Overdue follow-ups check: 6:00 PM
[CRON] - Appointment reminders: Every hour
```

### 3. ุงุฎุชุจุงุฑ API Endpoints

```bash
# ุงุฎุชุจุงุฑ ุงููุชุงุจุนุงุช
curl -X GET "http://localhost:5000/api/follow-up-tasks?clinic_id=xxx" \
  -H "Cookie: connect.sid=xxx"

# ุงุฎุชุจุงุฑ ุณุฌู ุงูุงุชุตุงูุงุช
curl -X GET "http://localhost:5000/api/patients/xxx/communications" \
  -H "Cookie: connect.sid=xxx"

# ุงุฎุชุจุงุฑ ุงููููุงุช
curl -X GET "http://localhost:5000/api/patients/xxx/files" \
  -H "Cookie: connect.sid=xxx"
```

## ๐ฑ ุชุญุฏูุซุงุช Frontend ุงููุทููุจุฉ

### 1. ุตูุญุฉ ุงููุชุงุจุนุงุช (Follow-ups Page)

ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ: `client/src/pages/followups/FollowUpList.tsx`

ุงูููููุงุช ุงููุทููุจุฉ:
- ูุงุฆูุฉ ุงููุชุงุจุนุงุช ุงููุณุชุญูุฉ
- ููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ (ูุนููุฉ/ููุชููุฉ)
- ุฒุฑ ุฅููุงู ุงููุชุงุจุนุฉ
- ุนุฑุถ ุงููุชุงุจุนุงุช ุงููุชุฃุฎุฑุฉ ุจููู ูููุฒ

### 2. ุชุญุณูู ุตูุญุฉ ููู ุงููุฑูุถ

ุฅุถุงูุฉ Tabs ุฌุฏูุฏุฉ ูู `client/src/pages/patients/PatientProfile.tsx`:

- **Tab: Medical History**
  - ุงูุฃูุฑุงุถ ุงููุฒููุฉ
  - ุงูุญุณุงุณูุฉ
  - ุงูุฃุฏููุฉ ุงูุญุงููุฉ
  
- **Tab: Files**
  - ุนุฑุถ ุงููููุงุช ุงููุฑููุฉ
  - ุฑูุน ูููุงุช ุฌุฏูุฏุฉ
  - ุชุตููู ุญุณุจ ุงูููุน

- **Tab: Communications**
  - ุณุฌู ุงูุงุชุตุงูุงุช
  - ุฅุถุงูุฉ ุงุชุตุงู ุฌุฏูุฏ
  - ุญุงูุฉ ูู ุงุชุตุงู

### 3. ุชุญุณูู Dashboard

ุชุญุฏูุซ `client/src/pages/dashboard/DoctorDashboard.tsx`:

- ุฅุถุงูุฉ ุจุทุงูุฉ "ุงููุชุงุจุนุงุช ุงููุนููุฉ"
- ุฅุถุงูุฉ ุจุทุงูุฉ "ุงููุชุงุจุนุงุช ุงููุชุฃุฎุฑุฉ"
- ุชุญุณูู ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช

### 4. ุดุงุดุฉ ุงููุดู

ุชุญุฏูุซ `client/src/pages/consultation/ConsultationView.tsx`:

- ุฅุถุงูุฉ ุญูู "ูุฏุฉ ุงููุชุงุจุนุฉ" (Follow-up Days)
- ุนูุฏ ุญูุธ ุงูุงุณุชุดุงุฑุฉุ ุฅูุดุงุก follow-up task ุชููุงุฆูุงู

## ๐ง ูููุงุช ุงูููุฏ ุงูุฌุฏูุฏุฉ

### Backend:
1. `server/cron/followUpScheduler.ts` - ูุธุงู Cron Jobs
2. `server/storage-mvp-additions.ts` - ุฏูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
3. `server/routes-mvp-additions.ts` - API Routes ุงูุฌุฏูุฏุฉ
4. `shared/schema-updates.sql` - SQL Migration

### Schema Updates:
- ุชุญุฏูุซุงุช ูู `shared/schema.ts`:
  - Enums ุฌุฏูุฏุฉ
  - ุฌุฏุงูู ุฌุฏูุฏุฉ
  - Zod schemas ุฌุฏูุฏุฉ

## ๐ ูุณุจุฉ ุงูุฅูุฌุงุฒ

### ูุจู ุงูุชุญุฏูุซุงุช: 75-80%
### ุจุนุฏ ุงูุชุญุฏูุซุงุช: 95-100%

## โ Checklist ุงูุชูุนูู

- [ ] ุชุทุจูู database migration
- [ ] ุฏูุฌ storage-mvp-additions ูุน storage.ts
- [ ] ุงูุชุญูู ูู ุนูู Cron Jobs
- [ ] ุงุฎุชุจุงุฑ API endpoints ุงูุฌุฏูุฏุฉ
- [ ] ุฅูุดุงุก ุตูุญุฉ ุงููุชุงุจุนุงุช ูู Frontend
- [ ] ุชุญุณูู ุตูุญุฉ ููู ุงููุฑูุถ
- [ ] ุชุญุฏูุซ Dashboard
- [ ] ุชุญุฏูุซ ุดุงุดุฉ ุงููุดู
- [ ] ุงุฎุชุจุงุฑ ุงููุธุงู ุจุงููุงูู

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุชุทุจูู Database Migration**
   ```bash
   npm run db:push
   ```

2. **ุฏูุฌ ุงูููุฏ ุงูุฌุฏูุฏ**
   - ุฏูุฌ storage-mvp-additions ูุน storage.ts
   - ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุชุนุงุฑุถุงุช

3. **ุชุทููุฑ Frontend**
   - ุฅูุดุงุก ุงูููููุงุช ุงููุทููุจุฉ
   - ุฑุจุทูุง ุจู API endpoints

4. **ุงูุงุฎุชุจุงุฑ**
   - ุงุฎุชุจุงุฑ ูู ููุฒุฉ ุนูู ุญุฏุฉ
   - ุงุฎุชุจุงุฑ ุงูุชูุงูู ุจูู ุงูููุฒุงุช
   - ุงุฎุชุจุงุฑ Cron Jobs

5. **ุงูุชูุซูู**
   - ุชูุซูู API endpoints
   - ุฏููู ุงููุณุชุฎุฏู
   - ุฏููู ุงููุทูุฑ

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Timezone**: ุฌููุน Cron Jobs ุชุณุชุฎุฏู ุชูููุช ุงููุงูุฑุฉ (Africa/Cairo)
2. **Notifications**: ูุชู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูููุชุงุจุนุงุช ูุงูููุงุนูุฏ
3. **File Storage**: ูุฌุจ ุฅุนุฏุงุฏ ูุธุงู ุฑูุน ุงููููุงุช (S3, Cloudinary, ุฃู ูุญูู)
4. **Security**: ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููุตูู ููู endpoint

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### Cron Jobs ูุง ุชุนูู:
- ุชุญูู ูู ุฃู `DATABASE_URL` ููุฌูุฏ ูู `.env`
- ุชุญูู ูู ุงูููุฌ ุนูุฏ ุจุฏุก ุงูุณูุฑูุฑ
- ุชุญูู ูู timezone

### API Endpoints ุชุนูุฏ 404:
- ุชุฃูุฏ ูู ุชุณุฌูู MVP routes ูู server/routes.ts
- ุชุญูู ูู ุงููุณุงุฑุงุช

### Database Errors:
- ุชุฃูุฏ ูู ุชุทุจูู migration
- ุชุญูู ูู ูุฌูุฏ ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ
- ุชุญูู ูู ุงูู foreign keys

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุชุ ุฑุงุฌุน:
- PRD.MD - ูุชุทูุจุงุช ุงููุดุฑูุน
- README.md - ุฏููู ุงูุชุดุบูู
- DOCUMENTATION_INDEX.md - ููุฑุณ ุงูุชูุซูู

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูู:** 2025-12-30
**ุงูุฅุตุฏุงุฑ:** MVP v1.0
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุชุทุจูู โ
